<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Medical Utility Tool</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      color: white;
    }
    .toolbar {
      display: flex;
      justify-content: space-around;
      align-items: center;
      background-color: #0b2349;
      padding: 10px;
      color: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.6);
      position: sticky;
      top: 0;
      z-index: 10000; /* toolbar always on top */
      user-select: none;
    }
    .toolbar button {
      background: #144a91cc; /* semi-transparent dark blue */
      border: none;
      padding: 10px 15px;
      margin: 0 5px;
      color: white;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
      user-select: none;
    }
    .toolbar button:hover {
      background: #1f5db3ee;
    }

    .page-content {
      padding: 20px;
      position: relative;
      min-height: 80vh;
      background: white;
      color: black;
      border-radius: 8px;
      max-width: 900px;
      margin: 20px auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }

    .hint-strip {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #0b2349cc; /* semi-transparent dark blue */
      color: #ffe066;
      padding: 10px;
      text-align: center;
      font-style: italic;
      font-size: 14px;
      z-index: 9999;
      user-select: none;
      box-shadow: 0 -2px 6px rgba(0,0,0,0.5);
    }

    .dropdown {
      display: none;
      position: absolute;
      top: 60px;
      left: 20px;
      right: 20px;
      background: rgba(11, 35, 73, 0.85); /* see-through dark blue */
      border: 1px solid #144a91cc;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.7);
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
      z-index: 11001; /* above word editor */
      flex-wrap: wrap;
      gap: 10px;
      color: white;
      font-size: 14px;
    }

    .dropdown.show {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .dropdown-item {
      background: rgba(20, 74, 145, 0.6);
      border: 1px solid #2c77d3aa;
      padding: 10px;
      border-radius: 8px;
      width: calc(50% - 15px);
      position: relative;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }

    .dropdown-item button {
      background: #1f5db3ee;
      border: none;
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 5px;
      cursor: pointer;
      color: white;
      font-weight: normal;
      transition: background 0.3s;
    }
    .dropdown-item button:hover {
      background: #3b82f6;
    }

    /* Formulary full page overlay */
    #formulary-overlay {
      display: none;
      position: fixed;
      top: 40px; /* below toolbar */
      left: 0; right: 0; bottom: 0;
      background: rgba(11, 35, 73, 0.95);
      color: white;
      z-index: 11002; /* above headers dropdown and word editor */
      padding: 20px;
      overflow-y: auto;
      font-size: 14px;
      font-family: Arial, sans-serif;
    }
    #formulary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    #formulary-header h2 {
      margin: 0;
    }
    #formulary-close {
      background: #1f5db3ee;
      border: none;
      color: white;
      padding: 8px 14px;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #formulary-close:hover {
      background: #3b82f6;
    }
    #search-container {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    #search-input {
      flex-grow: 1;
      padding: 8px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
      outline: none;
    }
    #search-button {
      padding: 8px 20px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 5px;
      border: none;
      background: #1f5db3ee;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }
    #search-button:hover {
      background: #3b82f6;
    }
    #formulary-results {
      max-height: 70vh;
      overflow-y: auto;
      border: 1px solid #2c77d3aa;
      border-radius: 8px;
      background: rgba(20,74,145,0.2);
      padding: 10px;
      user-select: none;
    }
    .formulary-entry {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 10px;
      border-bottom: 1px solid #2c77d3aa;
      font-weight: bold;
    }
    .formulary-entry:last-child {
      border-bottom: none;
    }
    .formulary-entry button {
      background: #1f5db3ee;
      border: none;
      padding: 5px 12px;
      border-radius: 5px;
      color: white;
      font-weight: normal;
      cursor: pointer;
      transition: background 0.3s;
    }
    .formulary-entry button:hover {
      background: #3b82f6;
    }

    .copy-ghost {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 12000;
      display: none;
      animation: glow-fade 5s ease-in-out;
      pointer-events: none;
      user-select: none;
      width: 120px;
      filter: drop-shadow(0 0 20px #58a6ff);
    }
    @keyframes glow-fade {
      0% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* Word Editor full-page overlay */
    #word-editor-overlay {
      display: none;
      position: fixed;
      top: 40px; /* below toolbar */
      left: 0; right: 0; bottom: 0;
      background: #e3e8f7;
      z-index: 1000; /* below headers dropdown and formulary */
      flex-direction: column;
      border-top: 4px solid #144a91;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      user-select: text;
    }

    #word-editor-header {
      background: #144a91cc;
      color: white;
      padding: 10px 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: bold;
      font-size: 18px;
    }
    #word-editor-back-btn {
      background: #1f5db3ee;
      border: none;
      color: white;
      padding: 6px 14px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
      user-select: none;
    }
    #word-editor-back-btn:hover {
      background: #3b82f6;
    }
    #word-editor-iframe {
      flex-grow: 1;
      border: none;
      width: 100%;
      height: calc(100vh - 40px - 48px); /* full height minus toolbar and header */
    }

    /* Wizard and chat bubble container and style */
    #wizard-container {
      position: fixed;
      top: 200px;
      left: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 350px;
      padding: 8px 12px;
      background: rgba(31, 93, 179, 0.85);
      border-radius: 15px;
      box-shadow: 0 0 15px #58a6ff;
      animation: glow 2s ease-in-out infinite alternate;
      z-index: 999;
      user-select: none;
    }

    @keyframes glow {
      0% {
        box-shadow: 0 0 15px #58a6ff;
      }
      100% {
        box-shadow: 0 0 30px #58a6ff;
      }
    }

    #wizard-img {
      width: 150px;
      height: auto;
      border-radius: 10px;
      user-select: none;
    }

    #bubble-body {
      white-space: pre-line;       /* preserve line breaks */
      overflow-wrap: break-word;
      word-break: break-word;
      max-height: 200px;           /* limit height */
      overflow-y: auto;            /* vertical scrollbar if content too big */
      padding-right: 8px;          /* prevent scrollbar overlap */
      line-height: 1.3;
      font-size: 15px;
    }

  </style>
</head>
<body>
  <div class="toolbar" role="navigation" aria-label="Main toolbar">
    <button onclick="window.top.location.href='https://script.google.com/macros/s/AKfycbyL54f4XL0gl_FJAgl26TMRAX06TWJUyYQropWj1K0uBQnSAlOqSIuOqZfUVctp-3z5/exec'">‚Üê Back</button>
    <button id="headers-btn" aria-haspopup="true" aria-expanded="false" aria-controls="dropdown-headers" onclick="toggleHeaders()">Headers</button>
    <button id="word-editor-btn" aria-haspopup="true" aria-expanded="false" onclick="toggleWordEditor()">Word Editor</button>
    <button id="formulary-btn" aria-haspopup="true" aria-expanded="false" onclick="toggleFormulary()">CA Formulary</button>
    <button onclick="navigate('jurisdiction')">Jurisdiction</button>
    <button onclick="navigate('updates')">Guideline Updates</button>
    <button onclick="navigate('jargons')">Jargons</button>
  </div>

  <div class="page-content" id="main-content" tabindex="-1">
    <h1>Welcome to the Medical Utility Tool</h1>
    <p>Select a tool from the toolbar above.</p>

    <div id="dropdown-headers" class="dropdown" role="menu" aria-label="Headers menu"></div>
  </div>

  <div class="hint-strip" id="hint-strip">Loading hints...</div>

  <img id="copy-ghost" class="copy-ghost" src="https://i.postimg.cc/d0jsn69H/Ghost.png" alt="Copied!" />

  <!-- Word Editor overlay -->
  <div id="word-editor-overlay" aria-hidden="true" role="dialog" aria-label="Word Editor">
    <div id="word-editor-header">
      Word Editor
      <button id="word-editor-back-btn" aria-label="Close Word Editor" onclick="toggleWordEditor()">Back</button>
    </div>
    <iframe id="word-editor-iframe" src="https://tesecumj.neocities.org/" title="Embedded Word Editor"></iframe>
  </div>

  <!-- Full page formulary overlay -->
  <div id="formulary-overlay" aria-hidden="true" role="dialog" aria-label="California Drug Formulary Search">
    <div id="formulary-header">
      <h2>CA Drug Formulary Search</h2>
      <button id="formulary-close" aria-label="Close Formulary Search" onclick="toggleFormulary()">Close</button>
    </div>
    <div id="search-container">
      <input id="search-input" type="search" placeholder="Search drug ingredient or brand name..." aria-label="Search drug ingredient or brand name" />
      <button id="search-button">Search</button>
    </div>
    <div id="formulary-results">Enter a search term and click Search.</div>
  </div>

  <!-- Wizard and chat bubble -->
  <div id="wizard-container" aria-live="polite" aria-atomic="true" aria-relevant="additions">
    <img id="wizard-img" src="https://i.postimg.cc/g0CKgrDV/Chat-GPT-Image-Jun-23-2025-02-01-13-PM.png" alt="Wizard" />
    <div id="chat-bubble">
      <div id="bubble-header">üö® <strong> Updates!! :</strong></div>
      <div id="bubble-body">Loading...</div>
    </div>
  </div>

<script>
  // === Headers Data ===
  const headers = {
    "Shoulder Disorders": "California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines\nShoulder Disorders (MTUS Effective Date August 10, 2023)",
    "Knee Disorders": "California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines\nKnee Disorders (MTUS Effective Date September 21, 2020)",
    "Low Back Disorders": "California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines\nLow Back Disorders (MTUS Effective Date November 23, 2021)",
    "Cervical and Thoracic Spine": "California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines\nCervical and Thoracic Spine (MTUS Effective Date April 18, 2019)",
    "Hand, Wrist, and Forearm Disorders": "California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines\nHand, Wrist, and Forearm Disorders (MTUS Effective Date November 10, 2023)",
    "Ankle and Foot Disorders": "California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines\nAnkle and Foot Disorders (MTUS Effective Date April 18, 2019)",
    "Elbow Disorders": "California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines\nElbow Disorders (MTUS Effective Date April 18, 2019)",
    "Hip and Groin Disorders": "California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines\nHip and Groin Disorders (MTUS Effective Date October 7, 2019)",
    "Chronic Pain": "California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines\nChronic Pain (Effective Date June 1, 2025)",
    "Antiemetics": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nAntiemetics (MTUS Effective Date: October 26, 2020)",
    "Cannabis": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nCannabis (MTUS Effective Date: June 1, 2025)",
    "COVID-19 (Coronavirus)": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nCOVID-19 (Coronavirus) (MTUS Effective Date: November 10, 2023)",
    "Eye Disorders": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nEye Disorders (MTUS Effective Date: December 1, 2017)",
    "Interstitial Lung Diseases": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nInterstitial Lung Diseases (MTUS Effective Date: September 21, 2020)",
    "Occupational Asthma": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nOccupational Asthma (MTUS Effective Date: September 21, 2020)",
    "Opioids": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nOpioids (MTUS Effective Date: March 27, 2024)",
    "Traumatic Brain Injury": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nTraumatic Brain Injury (MTUS Effective Date: October 31, 2018)",
    "Workplace Mental Health": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nWorkplace Mental Health (MTUS Effective Date: August 11, 2019)",
    "Posttraumatic Stress Disorder and Acute Stress Disorder": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nPosttraumatic Stress Disorder and Acute Stress Disorder (MTUS Effective Date: April 18, 2019)",
    "Anxiety Disorders": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nAnxiety Disorders (MTUS Effective Date: July 19, 2021)",
    "Depressive Disorders": "California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines\nDepressive Disorders (MTUS Effective Date: September 21, 2020)"
  };

  // === Hints ===
  const hints = [
    "Always refer to MTUS before approving opioid requests.",
    "Check the CA Formulary regularly for drug updates.",
    "Use the Word Editor to draft complex notes easily.",
    "Guideline updates are posted monthly.",
    "Use the Jurisdiction tab for local laws.",
    "Avoid off-label drug prescriptions unless justified."
  ];

  // === Helper to toggle dropdowns ===
  function toggleHeaders() {
  const dropdown = document.getElementById("dropdown-headers");
  const btn = document.getElementById("headers-btn");
  if (dropdown.classList.contains("show")) {
    dropdown.classList.remove("show");
    btn.setAttribute("aria-expanded", "false");
  } else {
    dropdown.classList.add("show");
    btn.setAttribute("aria-expanded", "true");
    populateHeaders();
    // Hide Formulary only, but NOT Word Editor
    hideFormulary();
    // DO NOT hideWordEditor();
  }
}


  // === Populate Headers dropdown ===
  function populateHeaders() {
    const dropdown = document.getElementById("dropdown-headers");
    dropdown.innerHTML = "";
    for (const [title, text] of Object.entries(headers)) {
      const div = document.createElement("div");
      div.className = "dropdown-item";
      div.textContent = title;
      // Add a button to view content in main page content area
      const btn = document.createElement("button");
      btn.textContent = "View";
      btn.onclick = () => {
        showHeaderContent(title, text);
        toggleHeaders();
      };
      div.appendChild(btn);
      dropdown.appendChild(div);
    }
  }

  // === Show selected header content in main content area ===
  function showHeaderContent(title, text) {
    const main = document.getElementById("main-content");
    main.innerHTML = `<h1>${title}</h1><pre>${text}</pre>`;
    main.focus();
  }

  // === Word Editor toggle ===
  function toggleWordEditor() {
    const overlay = document.getElementById("word-editor-overlay");
    const btn = document.getElementById("word-editor-btn");
    if (overlay.style.display === "flex") {
      overlay.style.display = "none";
      btn.setAttribute("aria-expanded", "false");
      // Return focus to toolbar
      btn.focus();
    } else {
      overlay.style.display = "flex";
      btn.setAttribute("aria-expanded", "true");
      // Hide others dropdowns
      hideHeaders();
      hideFormulary();
    }
  }

  function hideWordEditor() {
    const overlay = document.getElementById("word-editor-overlay");
    const btn = document.getElementById("word-editor-btn");
    overlay.style.display = "none";
    btn.setAttribute("aria-expanded", "false");
  }

  // === Formulary toggle ===
  function toggleFormulary() {
    const overlay = document.getElementById("formulary-overlay");
    const btn = document.getElementById("formulary-btn");
    if (overlay.style.display === "block") {
      overlay.style.display = "none";
      btn.setAttribute("aria-expanded", "false");
      btn.focus();
    } else {
      overlay.style.display = "block";
      btn.setAttribute("aria-expanded", "true");
      // Hide others
      hideHeaders();
      // DO NOT hide Word Editor - it must remain visible below
    }
  }

  function hideFormulary() {
    const overlay = document.getElementById("formulary-overlay");
    const btn = document.getElementById("formulary-btn");
    overlay.style.display = "none";
    btn.setAttribute("aria-expanded", "false");
  }

  function hideHeaders() {
    const dropdown = document.getElementById("dropdown-headers");
    const btn = document.getElementById("headers-btn");
    dropdown.classList.remove("show");
    btn.setAttribute("aria-expanded", "false");
  }

  // === Navigation placeholders ===
  function navigate(page) {
    alert("Navigate to: " + page);
  }

  // === Hint cycling ===
  let hintIndex = 0;
  function updateHint() {
    const strip = document.getElementById("hint-strip");
    strip.textContent = hints[hintIndex];
    hintIndex = (hintIndex + 1) % hints.length;
  }
  setInterval(updateHint, 7000);
  updateHint();

  // === Formulary Search - Placeholder ===
  document.getElementById("search-button").addEventListener("click", () => {
    const input = document.getElementById("search-input").value.trim().toLowerCase();
    const results = document.getElementById("formulary-results");
    if (!input) {
      results.textContent = "Please enter a search term.";
      return;
    }
    // Fake search demo
    results.innerHTML = `<div class="formulary-entry">Result for "<strong>${input}</strong>" <button onclick="copyToClipboard('Result for ${input}')">Copy</button></div>`;
  });

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
      const ghost = document.getElementById("copy-ghost");
      ghost.style.display = "block";
      setTimeout(() => (ghost.style.display = "none"), 4000);
    });
  }
</script>

</body>
</html>
