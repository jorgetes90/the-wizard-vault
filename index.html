<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Medical Utility Tool</title>
  <style>
    /* [existing styles retained from your last working copy] */
  </style>
</head>
<body>
  <!-- [existing HTML structure retained from your last working copy] -->

<script>
  // [existing script content retained and updated]

  function searchFormulary() {
    const term = searchInput.value.trim().toLowerCase();
    if (!term) {
      resultsContainer.textContent = 'Please enter a search term.';
      return;
    }
    const filtered = formularyData.filter(item => 
      item['Drug Ingredient'] && 
      item['Reference Brand Name'] && 
      item['Drug Ingredient'].toLowerCase().includes(term)
    );
    if (filtered.length === 0) {
      resultsContainer.textContent = 'No matching drugs found.';
      return;
    }
    const html = filtered.map(item => {
      const drug = item['Drug Ingredient'];
      const brand = item['Reference Brand Name'];
      const citation = item['General citation (All body parts)'] || '';
      const displayName = `${drug} â€” ${brand}`;
      const safeText = citation.replace(/"/g, '&quot;').replace(/`/g, '\`');
      return `<div class="formulary-entry">
        <span>${displayName}</span>
        <button onclick="copyCitation(\`${safeText}\`)" aria-label="Copy citation for ${displayName}">Copy</button>
      </div>`;
    }).join('');
    resultsContainer.innerHTML = html;
  }

  function copyCitation(text) {
    const clipboardText = text.replace(/\\n/g, '\n');
    navigator.clipboard.writeText(clipboardText).then(() => {
      const ghost = document.getElementById('copy-ghost');
      ghost.style.display = 'block';
      setTimeout(() => ghost.style.display = 'none', 5000);
    }).catch(() => alert('Copy failed'));
  }

  // [rest of the script remains unchanged]
</script>
</body>
</html>
