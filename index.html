<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Medical Utility Tool</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f5f5f5;
  }
  .toolbar {
    display: flex;
    justify-content: space-around;
    align-items: center;
    background-color: #1e1e2f;
    padding: 10px;
    color: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .toolbar button {
    background: #2f2f4f;
    border: none;
    padding: 10px 15px;
    margin: 0 5px;
    color: white;
    font-weight: bold;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
  }
  .toolbar button:hover {
    background: #4a4a6a;
  }

  .page-content {
    padding: 20px;
    position: relative;
  }

  .hint-strip {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #1e1e2f;
    color: #ffe066;
    padding: 10px;
    text-align: center;
    font-style: italic;
    font-size: 14px;
    z-index: 99;
  }

  /* Dropdown general styles */
  .dropdown {
    display: none;
    position: absolute;
    top: 60px;
    left: 20px;
    right: 20px;
    background: rgba(255 255 255 / 0.9);
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    max-height: 350px;
    overflow-y: auto;
    padding: 10px;
    z-index: 50;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    backdrop-filter: saturate(180%) blur(8px);
  }
  .dropdown.show {
    display: flex;
  }

  .dropdown-item {
    background: #f9f9f9cc;
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 8px;
    width: calc(33.33% - 13px);
    position: relative;
    font-size: 14px;
    box-shadow: 0 0 6px rgba(0,0,0,0.05);
    user-select: none;
  }
  .dropdown-item strong {
    display: block;
    margin-bottom: 8px;
  }
  .dropdown-item button {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 5px 10px;
    font-size: 12px;
    cursor: pointer;
    user-select: none;
  }

  .copy-ghost {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 9999;
    display: none;
    animation: glow-fade 5s ease-in-out;
  }
  @keyframes glow-fade {
    0% { opacity: 1; filter: drop-shadow(0 0 10px yellow); }
    100% { opacity: 0; filter: drop-shadow(0 0 0 transparent); }
  }

</style>
</head>
<body>
  <div class="toolbar">
    <button onclick="goBack()">‚Üê Back</button>
    <button onclick="toggleDropdown('headers')">Headers</button>
    <button onclick="toggleDropdown('formulary')">CA Formulary</button>
    <button onclick="navigate('jurisdiction')">Jurisdiction</button>
    <button onclick="navigate('updates')">Guideline Updates</button>
    <button onclick="navigate('jargons')">Jargons</button>
  </div>

  <div class="page-content" id="main-content">
    <h1>Welcome to the Medical Utility Tool</h1>
    <p>Select a tool from the toolbar above.</p>

    <!-- Headers dropdown -->
    <div id="dropdown-headers" class="dropdown"></div>
    <!-- Formulary dropdown -->
    <div id="dropdown-formulary" class="dropdown" style="top: 60px;"></div>
  </div>

  <div class="hint-strip" id="hint-strip">Loading hints...</div>

  <img
    id="copy-ghost"
    class="copy-ghost"
    src="https://i.postimg.cc/d0jsn69H/Ghost.png"
    width="120"
    alt="Copied!"
  />

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
  // Headers data
  const headers = {
    "Shoulder Disorders": `California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines
Shoulder Disorders (MTUS Effective Date August 10, 2023)`,
    "Knee Disorders": `California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines
Knee Disorders (MTUS Effective Date September 21, 2020)`,
    "Low Back Disorders": `California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines
Low Back Disorders (MTUS Effective Date November 23, 2021)`,
    "Cervical and Thoracic Spine": `California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines
Cervical and Thoracic Spine (MTUS Effective Date April 18, 2019)`,
    "Hand, Wrist, and Forearm Disorders": `California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines
Hand, Wrist, and Forearm Disorders (MTUS Effective Date November 10, 2023)`,
    "Ankle and Foot Disorders": `California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines
Ankle and Foot Disorders (MTUS Effective Date April 18, 2019)`,
    "Elbow Disorders": `California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines
Elbow Disorders (MTUS Effective Date April 18, 2019)`,
    "Hip and Groin Disorders": `California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines
Hip and Groin Disorders (MTUS Effective Date October 7, 2019)`,
    "Chronic Pain": `California Medical Treatment Utilization Schedule (MTUS)/ACOEM Practice Guidelines
Chronic Pain (Effective Date June 1, 2025)`,
    "Antiemetics": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Antiemetics (MTUS Effective Date: October 26, 2020)`,
    "Cannabis": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Cannabis (MTUS Effective Date: June 1, 2025)`,
    "COVID-19 (Coronavirus)": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
COVID-19 (Coronavirus) (MTUS Effective Date: November 10, 2023)`,
    "Eye Disorders": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Eye Disorders (MTUS Effective Date: December 1, 2017)`,
    "Interstitial Lung Diseases": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Interstitial Lung Diseases (MTUS Effective Date: September 21, 2020)`,
    "Occupational Asthma": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Occupational Asthma (MTUS Effective Date: September 21, 2020)`,
    "Opioids": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Opioids (MTUS Effective Date: March 27, 2024)`,
    "Traumatic Brain Injury": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Traumatic Brain Injury (MTUS Effective Date: October 31, 2018)`,
    "Workplace Mental Health": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Workplace Mental Health (MTUS Effective Date: August 11, 2019)`,
    "Posttraumatic Stress Disorder and Acute Stress Disorder": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Posttraumatic Stress Disorder and Acute Stress Disorder (MTUS Effective Date: April 18, 2019)`,
    "Anxiety Disorders": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Anxiety Disorders (MTUS Effective Date: July 19, 2021)`,
    "Depressive Disorders": `California Medical Treatment Utilization Schedule (MTUS) / ACOEM Practice Guidelines
Depressive Disorders (MTUS Effective Date: September 21, 2020)`
  };

  const hints = [
    "Always refer to MTUS before approving UR decisions.",
    "Jargon: 'UR' = Utilization Review.",
    "Updates from July 2024 include TBI revisions.",
    "Use Headers tool to copy citations quickly.",
    "Check CA Formulary for drug phase requirements.",
    "Guideline updates affect decision timelines.",
    "Jargon: 'RFA' = Request for Authorization."
  ];

  let hintIndex = 0;
  setInterval(() => {
    document.getElementById('hint-strip').textContent = hints[hintIndex];
    hintIndex = (hintIndex + 1) % hints.length;
  }, 7000);

  // Toggle dropdowns (headers or formulary)
  function toggleDropdown(name) {
    const headersDropdown = document.getElementById('dropdown-headers');
    const formularyDropdown = document.getElementById('dropdown-formulary');

    if(name === 'headers'){
      if(headersDropdown.classList.contains('show')){
        headersDropdown.classList.remove('show');
      } else {
        // Show headers, hide formulary
        formularyDropdown.classList.remove('show');
        buildHeadersDropdown();
        headersDropdown.classList.add('show');
      }
    }
    else if(name === 'formulary'){
      if(formularyDropdown.classList.contains('show')){
        formularyDropdown.classList.remove('show');
      } else {
        headersDropdown.classList.remove('show');
        buildFormularyDropdown();
        formularyDropdown.classList.add('show');
      }
    }
  }

  function buildHeadersDropdown() {
    const container = document.getElementById('dropdown-headers');
    container.innerHTML = '';
    for (let label in headers) {
      const item = document.createElement('div');
      item.className = 'dropdown-item';
      const strong = document.createElement('strong');
      strong.textContent = label;
      item.appendChild(strong);

      const btn = document.createElement('button');
      btn.textContent = 'Copy';
      btn.setAttribute('data-text', headers[label]);
      btn.addEventListener('click', copyText);
      item.appendChild(btn);

      container.appendChild(item);
    }
  }

  // For demonstration: placeholder formulary data, can be replaced by your CSV/JSON loading later
  let formularyData = [];

  // Load formulary CSV from Google Sheets
  function loadFormularyData() {
    return new Promise((resolve, reject) => {
      Papa.parse('https://docs.google.com/spreadsheets/d/e/2PACX-1vQjeLiC5oKL6wkw7fqz00Gg7qFG22vJabTjVLO4u4sN_zBIrLAbhvxhfBoYnMF2P935KgsnRBDdmqRl/pub?gid=52362647&single=true&output=csv', {
        download: true,
        header: true,
        complete: function(results) {
          formularyData = results.data.filter(row => row['Drug Ingredient']); // filter out empty rows
          resolve();
        },
        error: function(err) {
          alert('Error loading formulary data.');
          reject(err);
        }
      });
    });
  }

  function buildFormularyDropdown() {
    const container = document.getElementById('dropdown-formulary');
    container.innerHTML = `
      <input type="search" id="formulary-search" placeholder="Search drug ingredient..." style="width:100%; padding:8px; margin-bottom:10px; font-size:16px;" />
      <div id="formulary-results" style="max-height: 250px; overflow-y:auto;"></div>
    `;
    document.getElementById('formulary-search').addEventListener('input', onFormularySearch);

    // Load data if not already loaded
    if(formularyData.length === 0){
      loadFormularyData().then(() => {
        document.getElementById('formulary-search').focus();
      });
    } else {
      document.getElementById('formulary-search').focus();
    }
  }

  function onFormularySearch(e) {
    const query = e.target.value.trim().toLowerCase();
    const resultsContainer = document.getElementById('formulary-results');
    resultsContainer.innerHTML = '';
    if (!query) {
      resultsContainer.innerHTML = '<p style="color:#666;">Type to search for drug ingredients...</p>';
      return;
    }
    const matches = formularyData.filter(item => item['Drug Ingredient'].toLowerCase().includes(query));
    if(matches.length === 0){
      resultsContainer.innerHTML = '<p style="color:#666;">No matching drugs found.</p>';
      return;
    }
    matches.forEach(item => {
      const div = document.createElement('div');
      div.className = 'dropdown-item';
      div.style.width = '100%';
      div.innerHTML = `
        <strong>${item['Drug Ingredient'] || 'N/A'}</strong><br />
        Reference Brand: ${item['Reference Brand Name'] || 'N/A'}
      `;
      const btn = document.createElement('button');
      btn.textContent = 'Copy';
      btn.addEventListener('click', () => {
        copyFormularyText(item);
      });
      div.appendChild(btn);
      resultsContainer.appendChild(div);
    });
  }

  function copyFormularyText(item) {
    const textToCopy = item['General citation (All body parts)'] || '';
    if (!textToCopy) {
      alert('No citation text available to copy.');
      return;
    }
    navigator.clipboard.writeText(textToCopy).then(() => {
      showGhost();
    }).catch(() => alert('Copy failed'));
  }

  // Copy from Headers dropdown
  function copyText(e) {
    const text = e.target.getAttribute('data-text');
    navigator.clipboard.writeText(text).then(() => {
      showGhost();
    }).catch(() => alert('Copy failed'));
  }

  function showGhost() {
    const ghost = document.getElementById('copy-ghost');
    ghost.style.display = 'block';
    setTimeout(() => {
      ghost.style.display = 'none';
    }, 5000);
  }

  function goBack() {
    alert('Going back to main home page...');
  }

  function navigate(section) {
    document.getElementById('main-content').innerHTML = `<h2>Loading ${section}...</h2>`;
    document.getElementById('dropdown-headers').classList.remove('show');
    document.getElementById('dropdown-formulary').classList.remove('show');
  }

</script>
</body>
</html>
